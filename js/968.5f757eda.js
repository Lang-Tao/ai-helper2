"use strict";(self["webpackChunkmy_app"]=self["webpackChunkmy_app"]||[]).push([[968],{96968:function(e,t,o){o.r(t),o.d(t,{default:function(){return d}});var r=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"intelligence-check"},[o("div",{staticClass:"select-box"},[o("div",[o("el-select",{attrs:{placeholder:"请选择项目"},model:{value:e.selectedProjectName,callback:function(t){e.selectedProjectName=t},expression:"selectedProjectName"}},e._l(e.projectList,(function(e){return o("el-option",{key:e.address,attrs:{value:e.name}})})),1),o("el-cascader",{staticStyle:{"margin-left":"20px",width:"500px"},attrs:{options:e.fileList,props:e.cascaderProps},model:{value:e.selectedFile,callback:function(t){e.selectedFile=t},expression:"selectedFile"}})],1),o("div",[o("el-button",{attrs:{type:"primary"},on:{click:e.review}},[e._v("审查")]),o("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("提交")])],1)]),o("div",{staticClass:"overview"},[o("div",{staticClass:"code-view"},[0===e.fileContent.length?o("div",{staticClass:"empty-box"},[o("span",{staticClass:"empty-text"},[e._v("请在上方选择审查文件")])]):o("div",{staticClass:"code-box"},[o("pre",[e._v(e._s(e.fileContent))])])]),o("div",{staticClass:"comment"},[o("el-input",{attrs:{type:"textarea",autosize:{minRows:8,maxRows:20},placeholder:"请输入审查意见"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}})],1)])])},s=[],n=o(27673),i={name:"personCheck",components:{},data(){return{comment:"",projectList:[],fileList:[],cascaderProps:{value:"name",label:"name",children:"children"},selectedFile:"",selectedProjectName:"",repository:{},fileContent:""}},computed:{},methods:{getFileList(){(0,n.WV)(this.selectedProjectRepo).then((e=>{console.log(this.selectedProjectName+"文件列表："),console.log(e),0===e.code?(this.fileList=this.removeEmptyChildren(e.data.fileList),console.log("修改后的数据"),console.log(this.fileList)):console.error(e.message||"获取列表失败")})).catch((e=>{console.error("Error:",e)}))},removeEmptyChildren(e){return e.map((e=>(e.children&&e.children.length>0&&(e.children=this.removeEmptyChildren(e.children)),e.children&&0===e.children.length&&delete e.children,e)))},getProjectList(){(0,n.wD)().then((e=>{console.log("项目列表："),console.log(e),0===e.code?(this.projectList=e.data,this.selectedProjectName=this.projectList.length>0?this.projectList[0].name:""):console.error(e.message||"获取列表失败")})).catch((e=>{console.error("Error:",e)}))},review(){0!==this.selectedFile.length?(console.log("path:"+this.selectedFile.join("/")+"   address:"+this.selectedProjectAddress),(0,n.RX)(this.selectedFile.join("/"),this.selectedProjectAddress).then((e=>{console.log("文件内容："),console.log(e),0===e.code?this.fileContent=e.data:console.error(e.message||"获取文件内容失败")}))):this.$message.warning("请选择文件")},submit(){this.comment="",this.fileContent="",this.$message.success("提交成功")}},mounted(){this.getProjectList(),this.getFileList()},watch:{selectedProjectName(e){this.getFileList()}},computed:{selectedProjectRepo(){return this.projectList.find((e=>e.name===this.selectedProjectName))?.repositoryId},selectedProjectAddress(){return this.projectList.find((e=>e.name===this.selectedProjectName))?.address}}},c=i,l=o(81656),a=(0,l.A)(c,r,s,!1,null,"529d1388",null),d=a.exports},27673:function(e,t,o){o.d(t,{An:function(){return i},RX:function(){return a},WV:function(){return l},gA:function(){return n},vr:function(){return c},wD:function(){return s},xx:function(){return d}});var r=o(35720);function s(){return(0,r.A)({url:"/project",method:"GET",headers:{Authorization:localStorage.getItem("token")}})}function n(e){return(0,r.A)({url:"/project",method:"POST",data:e,headers:{Authorization:localStorage.getItem("token")}})}function i(e){return(0,r.A)({url:`/project/address?address=${e}`,method:"GET",headers:{Authorization:localStorage.getItem("token")}})}function c(e){return(0,r.A)({url:"/project",method:"PUT",data:e,headers:{Authorization:localStorage.getItem("token")}})}function l(e){return(0,r.A)({url:`/gitea/listpath?repo=${e}`,method:"GET",headers:{Authorization:localStorage.getItem("token")}})}function a(e,t){return(0,r.A)({url:`/gitea/getfile?path=${e}&address=${t}`,method:"GET",headers:{Authorization:localStorage.getItem("token")}})}function d(e){return(0,r.A)({url:`/project?address=${e}`,method:"DELETE",headers:{Authorization:localStorage.getItem("token")}})}}}]);
//# sourceMappingURL=968.5f757eda.js.map